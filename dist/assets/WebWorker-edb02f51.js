(function(){"use strict";const C=.5*(Math.sqrt(3)-1),y=(3-Math.sqrt(3))/6,j=n=>Math.floor(n)|0,T=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function N(n=Math.random){const o=U(n),s=new Float64Array(o).map(c=>T[c%12*2]),t=new Float64Array(o).map(c=>T[c%12*2+1]);return function(l,p){let O=0,E=0,I=0;const L=(l+p)*C,z=j(l+L),S=j(p+L),R=(z+S)*y,K=z-R,Q=S-R,a=l-K,r=p-Q;let g,m;a>r?(g=1,m=0):(g=0,m=1);const b=a-g+y,v=r-m+y,D=a-1+2*y,w=r-1+2*y,A=z&255,F=S&255;let h=.5-a*a-r*r;if(h>=0){const e=A+o[F],d=s[e],u=t[e];h*=h,O=h*h*(d*a+u*r)}let x=.5-b*b-v*v;if(x>=0){const e=A+g+o[F+m],d=s[e],u=t[e];x*=x,E=x*x*(d*b+u*v)}let f=.5-D*D-w*w;if(f>=0){const e=A+1+o[F+1],d=s[e],u=t[e];f*=f,I=f*f*(d*D+u*w)}return 70*(O+E+I)}}function U(n){const s=new Uint8Array(512);for(let t=0;t<512/2;t++)s[t]=t;for(let t=0;t<512/2-1;t++){const c=t+~~(n()*(256-t)),l=s[t];s[t]=s[c],s[c]=l}for(let t=256;t<512;t++)s[t]=s[t-256];return s}class X{position={x:0,y:0};velocity=0;direction;lastPos;screenOffset=10;constructor(o,s){this.position=o,this.direction=s,this.lastPos={x:o.x,y:o.y},this.normalizeDir()}accel(o){this.velocity+=o}affect(o){this.direction.x+=o.x*.5,this.direction.y+=o.y*.5,this.normalizeDir()}normalizeDir(){const o=Math.sqrt(this.direction.x**2+this.direction.y**2);this.direction.x/=o,this.direction.y/=o}setPosition(o){this.position.x=o.x,this.position.y=o.y}update(o){this.lastPos.x=this.position.x,this.lastPos.y=this.position.y,this.position.x+=this.direction.x*this.velocity*o,this.position.y+=this.direction.y*this.velocity*o}}function q(n,o){return Math.random()*(o-n)+n}const Y=N(),k=100,B=20,H=Math.PI*2,G=5e-4,i=100,M=n=>{const o={x:Math.floor(n.x),y:Math.floor(n.y)},s=Y(o.x*G,o.y*G)*H;return{x:Math.cos(s),y:Math.sin(s)}},J=500;let P=[];for(let n=0;n<J;n++)P.push(new X({x:4e4,y:4e4},M({x:5e3,y:5e3})));onmessage=n=>{const{screenSize:o,delta:s}=n.data;P.forEach(t=>{t.velocity<k&&t.accel(s*B),t.affect(M(t.position)),t.update(s),(t.position.x>o.x+i||t.position.x<-i||t.position.y>o.y+i||t.position.y<-i)&&(t.position.x=q(-i,o.x+i),t.position.y=q(-i,o.y+i),t.lastPos.x=t.position.x,t.lastPos.y=t.position.y,t.direction=M(t.position),t.velocity=0)}),postMessage(P)}})();
